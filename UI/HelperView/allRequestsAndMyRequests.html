<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    
    <title>Document</title>
    <link rel="stylesheet" href="../css/main.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    
  </head>
  <body>
      <div class="navBar">
        <img src="../Photos/ShareNet.png" alt="Share Net Logo" style="width: 17.5%;margin-left:5%;">
        <h2 style="float:right;margin-right:20%;margin-top:7.5%">My Account</h2>
        <br>
      </div>
    </div>
    <div id=RequestFinder>
      <div class="requestTopBar">
        <h2 style="text-align:center;">Requests Near Me</h2>
      </div> 
      <div id=mapStuff>
        <style>
          #map{
            height:400px;
            width:100%; }

        </style>
        <!-- <h1> My Google Map </h1> -->
        <div id="map"></div>
        <script>

          var R = 6373;
          var username = "Alex"; 
          var userData;
          function postUserData(data){
            userData = data;
            $.get("../../data/log.json",function(data) {

                  parseLog(data);
                });

          } 
        $.get("../../data/UserData/"+username+".json",function(data) {
              postUserData(data);
            }); 
          
        function sortProperties(obj){
          // convert object into array
        var sortable=[];
        for(var key in obj)
          if(obj.hasOwnProperty(key))
            sortable.push([key, obj[key]]); // each item is an array in format [key, value]
        
        // sort items by value
        sortable.sort(function(a, b)
        {
          return a[1]-b[1]; // compare numbers
        });
        return sortable; // array in format [ [ key1, val1 ], [ key2, val2 ], ... ]
      }

            function parseLog(log){
              console.log(log);
              var dist = {};
              for (var ID in log){
                
                var dlon = Math.PI*userData["long"]-log[ID]["long"]/180;
                var dlat = Math.PI*userData["lat"]-log[ID]["lat"]/180;
                var a = (Math.sin(dlat/2)*Math.sin(dlat/2)) + Math.cos(lat1) * Math.cos(lat2) * (Math.sin(dlon/2)*Math.sin(dlon/2));
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                var d = R * c;
                dist[ID] = d;
                console.log(dist[ID]);
              }
              console.log(dist);
              var sortedDists = sortProperties(dist);
              console.log(sortedDists);
              
            }
            function initMap(){
              var options = {
                zoom:8, 
                center:{lat:42,lng:-71}
              }

              var map = new google.maps.Map(document.getElementById('map'), options);
              var geocoder = new google.maps.Geocoder();

            console.log(findCoords(geocoder, map, "123 Main St, Lexington, MA, 02421"))
             
              
      /*
              var marker = new google.maps.Marker({
                position:{lat:42,lng:-70},
                map:map
                });
              var infoWindow=new google.maps.InfoWindow({content:'<h1> Cape Cod</h1>'});
              marker.addListener('click', function(){infoWindow.open(map, marker);});
      */    
          function addMarker(coords, name){
            var marker = new google.maps.Marker({
                position:coords,
                map:map
                });
            var infoWindow=new google.maps.InfoWindow({content:'<h1>'+ name +'</h1>'});
                marker.addListener('click', function(){infoWindow.open(map, marker);});

          }
          
          addMarker({lat:42, lng:-70},"Alex")
          addMarker({lat:41, lng: -71},"Sarah")
          

          function findCoords(geocoder, resultsMap, address) {
                geocoder.geocode({'address': address}, function(results, status) {
                if (status === 'OK') { return(results[0].geometry.location.lat());

                /*
                  resultsMap.setCenter(results[0].geometry.location);
                  var marker = new google.maps.Marker({
                    map: resultsMap,
                    position: results[0].geometry.location
                  });*/
                } else {
                  alert('Geocode was not successful for the following reason: ' + status);
                  return;
                }
                //return status;

              });
            }
        }


            
          </script>



        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADkEWk0rw92U2RLe3_8z0ejK1MQ-mUs9w&callback=initMap"
          async defer></script>
      </div>
      <div id="currentlyViewingRequest">
        <h3 style="text-align:center; color:#696969">Currently Viewing</h3>
        <p>Mary Jones</p> <br>
        <p>781-666-0114</p><br>
        <p>10/5/2020</p> <br>
        <p>Ingredient List: <br>
        - 3 green peppers <br>
        - 4 lemons <br>
        - 2 chicken breasts</p><br>
        <p>Status</p>

      </div>
    </div>
  </body>
</html>